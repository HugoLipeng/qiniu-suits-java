# 数据源输入

## 简介
从支持的数据源中读入文件列表，部分数据需要指定行解析方式或所需格式分隔符，读取指定位置的字段作为输入值进行下一步处理。  

## 配置文件选项

### 公共参数
```
source-type=list/file (v.2.11 及以上版本也可以使用 source=list/file，或者不设置该参数)
path=
threads=30
unit-len=10000
```  
|参数名|参数值及类型 |含义|  
|-----|-------|-----|  
|source-type/source| 字符串 file/list | 选择从[本地路径文件中读取]还是从[七牛空间列举]资源列表|  
|path| 输入源路径字符串| 资源列表路径，file源时填写本地文件或者目录路径，list源时可填写"qiniu://\<bucket\>"|  
|threads| 整型数| 表示预期最大线程数，若实际得到的文件数或列举前缀数小于该值时以实际数目为准|  
|unit-len| 整型数字| 表示一次读取的文件个数（读取或列举长度，默认值 10000），对应与读取文件时每次处理的行数或者列举请求时设置的 limit 参数|  

### 1. list 源可选参数
```
ak=
sk=
bucket=
marker=
start=
end=
prefixes=
anti-prefixes=
prefix-left=
prefix-right=
```
|参数名|参数值及类型 |含义|  
|-----|-------|-----|  
|ak、sk|长度 40 的字符串|七牛账号的密钥对字符串，通过七牛控制台个人中心获取|  
|bucket|字符串| 需要列举的空间名称，通过 "path=qiniu://<bucket>" 来设置的话此参数可不设置，设置则会覆盖 path 中指定的 bucket 值|  
|threads| 整型数字| 表示并发列举时使用的线程数（默认 30）|  
|unit-len| 整型数字| 表示每次列举请求列举的文件个数（列举长度，默认值 10000）|  
|prefixes| 字符串| 表示只列举某些文件名前缀的资源，，支持以 `,` 分隔的列表，如果需要表示 "," 作为前缀的话需要加双转义符表示为 "\\,"|  
|prefix-config| 字符串| 该选项用于设置列举前缀的配置文件路径，配置文件格式为 json，用于设置多个 <prefix>、<start/marker>、<end>，用于在同时指定多个前缀且可选起始位置时使用，配置举例：[prefix.json 配置](../resources/prefixes.json)，该配置会覆盖 prefixes 的配置|
|anti-prefixes| 字符串| 表示列举时排除某些文件名前缀的资源，支持以 `,` 分隔的列表，"," 同样需要双转义符|  
|prefix-left| true/false| 当设置 prefixes 时，可选择是否在prefixes ASCII顺序之前的所有未知前缀的文件是否进行列举|  
|prefix-right| true/false| 当设置 prefixes 时，可选择是否在prefixes ASCII顺序之后的所有未知前缀的文件是否进行列举|  

#### # prefix-config 配置文件写法如下：
```
{
  "a":{
    "marker":"",
    "start":"",
    "end":""
  },
  "b":{
    "marker":"",
    "start":"",
    "end":""
  }
}
```
|必须选项|含义|  
|-----|-----|  
|marker| 从指定 marker 的位置开始列举，该参数与 start 参数含义相同，同时设置时忽略 start 使用 marker |  
|start| 从指定文件名开始列举，该参数必须是正确且存在的文件名，否则会产生错误的 marker 从而无法列举 |  
|end| 文件名字符串，可以是完整的文件名，也可以是文件名前缀，程序列举时会以该文件信息作为结束位置 |  

#### # 关于并发列举
1、算法描述：使用前缀索引为每一个前缀 (第一级默认为连贯的 ASCII 常见字符) 创建一个列举对象，每个列
  举对象可以列举直到结束，在获取多个有效的列举对象之后，分别加入起始（无前缀，但到第一个前缀结束）列举对象和修改终止对象的前缀，随即开始并发执行列举，
  分别对输出结果进行后续处理。前缀索引个数和起始与终止列举对象的前缀会随自定义参数 prefixes/prefix-config 和 anti-prefixes 而改变，前者为指
  定列举的公共前缀，anti-prefixes 表示从所有列举操作中排除包含该前缀的情况，通常 prefixes 和 anti-prefixes 不同时进行设置。  

2、大量文件时建议：threads=100, unit-len=10000，参数值在机器配置较高时可以调高，如16核32G的机器可选择 200 个线程，但是不建议过高，unit-len
  通常不超过 100000。500 万以内文件建议 threads<=100，文件数目较少时不建议使用较多线程，如 100 万左右及以下的文件建议线程数少于 50，甚至更少
  文件时可使用单线程直接列举：threads=1。（文件数较少时若设置并发线程数偏多则会增加额外耗时）  

3、列举线程数根据实际文件数量调整，通常线程数较多的情况下并发效果较好，列举速度较快，原因是并发列举之前需要分析空间文件的前缀，线程数多增递进到的前缀
  更多，则各线程需要列举的文件数量相对平均，达到比较好的并发效果。如果出现某些前缀的文件特别多的情况，则可能出现线程池中大部分线程列举完成了最后还在
  列举少量前缀的文件，理论上一定会出现在后期列举速度变慢的情况，但是整体加速效果还是非常明显的。  

### 2. file 源可选参数
```
parse=
separator=
indexes=0,1,2
```
|参数名|参数值及类型 |含义|  
|-----|-------|-----|  
|parse| 字符串 json/tab/csv| 数据行格式，json 表示使用 json 解析，tab 表示使用分隔符（默认 "\t"）分割解析，csv 表示使用 "," 分割解析|  
|separator| 字符串| 当 parse=tab 时，可另行指定该参数为格式分隔符来分析字段|  
|indexes| 字符串列表| 资源元信息字段索引（下标），设置输入行对应的元信息字段下标，默认只有 key 的下标，parse=tab/csv 时为 "0"，parse=json 时默认为 "key"|  

#### # 关于 indexes 索引
indexes 指输入行中包含的资源元信息字段的映射关系，指定索引的顺序为 key,hash,fsize,putTime,mimeType,type,status,endUser，默认情况下，程
序只从输入行中读取 key 字段数据，parse=tab/csv 时索引为 0，parse=json 时索引为 "key"，需要指定更多字段时可设置为数字: 0,1,2,3 等或者 json
的 key 名称列表，长度不超过 8，长度表明取对应顺序的前几个字段。当 parse-type=tab 时索引必须均为整数，如果输入行中本身只包含部分字段，则可以在缺
少字段的顺序位置用 -1 索引表示，表示跳过该顺序对应的字段，例如原输入行中不包含 mimeType 和 type 字段，则可以设置 indexes =0,1,2,3,-1,-1,6。  


## 命令行方式
```
-source= -path= threads= -unit-len= [-<name>=<value>]...
```
